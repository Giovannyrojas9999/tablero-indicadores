<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Indicadores</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <style>
        body {
            background-color: #f4f6f8;
            font-family: 'Segoe UI', sans-serif;
        }
        .card {
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .kpi {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .table-responsive {
            max-height: 350px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
<div class="container my-4">
    <h2 class="mb-4 text-center">Indicadores</h2>

    <!-- KPIs -->
    <div class="row mb-4 g-3 text-center">
        <div class="col-md-4">
            <div class="card p-3 bg-primary text-white">
                <div>Total Ventas</div>
                <div class="kpi" id="kpiTotalVentas">$0</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-3 bg-success text-white">
                <div>Producto Más Vendido</div>
                <div class="kpi" id="kpiProductoTop">-</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-3 bg-warning text-white">
                <div>Categoría Líder</div>
                <div class="kpi" id="kpiCategoriaTop">-</div>
            </div>
        </div>
    </div>

    <!-- Botones y filtros -->
    <div class="row mb-4">
        <div class="col-md-8 d-flex gap-2">
            <button id="btnActualizar" class="btn btn-primary"><i class="fas fa-sync-alt"></i> Actualizar</button>
            <button id="btnEliminar" class="btn btn-danger"><i class="fas fa-trash-alt"></i> Eliminar</button>
            <button id="btnExportar" class="btn btn-success"><i class="fas fa-file-excel"></i> Exportar CSV</button>
        </div>
        <div class="col-md-4">
            <select class="form-select" id="filtroCategoria">
                <option value="Todos" selected>Filtrar por categoría</option>
            </select>
        </div>
    </div>

    <!-- Grid 2x2 con tabla y gráficos -->
    <div class="row g-4">
        <!-- Tabla -->
        <div class="col-md-6">
            <div class="card p-3">
                <h5 class="card-title">Tabla de Ventas</h5>
                <div class="table-responsive">
                    <table class="table table-hover" id="tablaDatos">
                        <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Producto</th>
                            <th>Categoría</th>
                            <th>Cantidad</th>
                            <th>Precio</th>
                            <th>Total</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Gráfico de barras -->
        <div class="col-md-6">
            <div class="card p-3">
                <h5 class="card-title">Ventas por Producto</h5>
                <div class="chart-container">
                    <canvas id="graficoBarras"></canvas>
                </div>
            </div>
        </div>

        <!-- Gráfico de líneas -->
        <div class="col-md-6">
            <div class="card p-3">
                <h5 class="card-title">Ventas Mensuales</h5>
                <div class="chart-container">
                    <canvas id="graficoLineas"></canvas>
                </div>
            </div>
        </div>

        <!-- Gráfico de pastel -->
        <div class="col-md-6">
            <div class="card p-3">
                <h5 class="card-title">Distribución por Categoría</h5>
                <div class="chart-container">
                    <canvas id="graficoPastel"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Datos de ejemplo más robustos
    const datos = [
        {id:1, producto:"Laptop", categoria:"Electrónica", cantidad:12, precio:1200},
        {id:2, producto:"Celular", categoria:"Electrónica", cantidad:30, precio:800},
        {id:3, producto:"Auriculares", categoria:"Accesorios", cantidad:50, precio:60},
        {id:4, producto:"Teclado", categoria:"Accesorios", cantidad:40, precio:70},
        {id:5, producto:"Silla", categoria:"Muebles", cantidad:20, precio:150},
        {id:6, producto:"Mesa", categoria:"Muebles", cantidad:15, precio:300},
        {id:7, producto:"Monitor", categoria:"Electrónica", cantidad:18, precio:350},
        {id:8, producto:"Mouse", categoria:"Accesorios", cantidad:60, precio:40},
        {id:9, producto:"Estantería", categoria:"Muebles", cantidad:10, precio:250}
    ];

    const tablaBody = document.querySelector("#tablaDatos tbody");
    const filtroCategoria = document.getElementById("filtroCategoria");

    function llenarFiltro() {
        const categorias = [...new Set(datos.map(d=>d.categoria))];
        filtroCategoria.innerHTML = '<option value="Todos" selected>Filtrar por categoría</option>';
        categorias.forEach(cat => filtroCategoria.innerHTML += `<option value="${cat}">${cat}</option>`);
    }

    function actualizarTabla() {
        const filtro = filtroCategoria.value;
        tablaBody.innerHTML = "";
        const datosFiltrados = filtro === "Todos" ? datos : datos.filter(d=>d.categoria===filtro);
        datosFiltrados.forEach(item => {
            tablaBody.innerHTML += `<tr>
                <td>${item.id}</td>
                <td>${item.producto}</td>
                <td>${item.categoria}</td>
                <td>${item.cantidad}</td>
                <td>$${item.precio}</td>
                <td>$${item.cantidad * item.precio}</td>
            </tr>`;
        });
        actualizarKPI(datosFiltrados);
        actualizarGraficos(datosFiltrados);
    }

    // KPIs
    function actualizarKPI(filtroDatos) {
        const totalVentas = filtroDatos.reduce((sum,d)=>sum + d.cantidad * d.precio,0);
        document.getElementById("kpiTotalVentas").innerText = `$${totalVentas}`;
        const productoTop = filtroDatos.reduce((a,b)=>a.cantidad>b.cantidad?a:b,{});
        document.getElementById("kpiProductoTop").innerText = productoTop.producto || '-';
        const categorias = {};
        filtroDatos.forEach(d=> categorias[d.categoria] = (categorias[d.categoria]||0)+d.cantidad*d.precio);
        const categoriaTop = Object.keys(categorias).reduce((a,b)=>categorias[a]>categorias[b]?a:b,'-');
        document.getElementById("kpiCategoriaTop").innerText = categoriaTop;
    }

    // Charts
    const ctxBarras = document.getElementById('graficoBarras').getContext('2d');
    const graficoBarras = new Chart(ctxBarras, {type:'bar', data:{labels:[], datasets:[{label:'Cantidad Vendida', data:[], backgroundColor:'rgba(54,162,235,0.7)', borderColor:'rgba(54,162,235,1)', borderWidth:1}]}, options:{responsive:true}});
    
    const ctxLineas = document.getElementById('graficoLineas').getContext('2d');
    const graficoLineas = new Chart(ctxLineas, {type:'line', data:{labels:["Enero","Febrero","Marzo","Abril","Mayo"], datasets:[{label:'Ventas Mensuales', data:[5000,7000,6000,8000,7500], borderColor:'rgba(255,99,132,1)', backgroundColor:'rgba(255,99,132,0.2)', tension:0.4} ] }, options:{responsive:true}});
    
    const ctxPastel = document.getElementById('graficoPastel').getContext('2d');
    const graficoPastel = new Chart(ctxPastel, {type:'pie', data:{labels:[], datasets:[{label:'Categorías', data:[], backgroundColor:['rgba(255,206,86,0.7)','rgba(75,192,192,0.7)','rgba(153,102,255,0.7)'], borderColor:['rgba(255,206,86,1)','rgba(75,192,192,1)','rgba(153,102,255,1)'], borderWidth:1} ] }, options:{responsive:true}});

    function actualizarGraficos(filtroDatos) {
        // Barra
        graficoBarras.data.labels = filtroDatos.map(d=>d.producto);
        graficoBarras.data.datasets[0].data = filtroDatos.map(d=>d.cantidad);
        graficoBarras.update();
        // Pastel
        const categorias = [...new Set(filtroDatos.map(d=>d.categoria))];
        graficoPastel.data.labels = categorias;
        graficoPastel.data.datasets[0].data = categorias.map(cat=>filtroDatos.filter(d=>d.categoria===cat).reduce((sum,d)=>sum+d.cantidad,0));
        graficoPastel.update();
    }

    // Botones
    document.getElementById("btnActualizar").addEventListener("click", actualizarTabla);
    document.getElementById("btnEliminar").addEventListener("click", ()=>{
        if(confirm("¿Eliminar todos los datos?")) { datos.length = 0; actualizarTabla(); }
    });
    document.getElementById("btnExportar").addEventListener("click", ()=>{
        let csv = "ID,Producto,Categoría,Cantidad,Precio,Total\n";
        datos.forEach(d=>csv+=`${d.id},${d.producto},${d.categoria},${d.cantidad},${d.precio},${d.cantidad*d.precio}\n`);
        const blob = new Blob([csv],{type:"text/csv"});
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download="datos.csv";
        link.click();
    });

    filtroCategoria.addEventListener("change", actualizarTabla);

    // Inicialización
    llenarFiltro();
    actualizarTabla();
</script>
</body>
</html>
